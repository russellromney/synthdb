<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Feature Proposal: Database Branching - SynthDB Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #336790;
  --color-brand-content: #336790;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #4A9EE0;
  --color-brand-content: #4A9EE0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #4A9EE0;
  --color-brand-content: #4A9EE0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">SynthDB Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  
</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/development/feature-proposals/database-branching.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="feature-proposal-database-branching">
<h1>Feature Proposal: Database Branching<a class="headerlink" href="#feature-proposal-database-branching" title="Link to this heading">¶</a></h1>
<div class="status-badge status-proposed">Proposed</div>
<p><strong>Authors</strong>: SynthDB Development Team<br />
<strong>Created</strong>: 2024-06-26<br />
<strong>Status</strong>: Proposal<br />
<strong>Complexity</strong>: High</p>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Add branching capabilities to SynthDB, allowing users to create isolated copies of database files, perform operations on them, and optionally merge changes back to the main database. This would enable safe experimentation, parallel development workflows, and atomic multi-operation transactions.</p>
</section>
<section id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Link to this heading">¶</a></h2>
<section id="use-cases">
<h3>Use Cases<a class="headerlink" href="#use-cases" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Experimental Development</strong>: Test schema changes or data transformations without affecting production data</p></li>
<li><p><strong>Parallel Workflows</strong>: Multiple developers or processes working on different features simultaneously</p></li>
<li><p><strong>Atomic Complex Operations</strong>: Perform multiple related operations that should succeed or fail together</p></li>
<li><p><strong>Rollback Scenarios</strong>: Easy rollback to previous states before applying risky operations</p></li>
<li><p><strong>A/B Testing</strong>: Compare different data processing approaches on the same dataset</p></li>
<li><p><strong>Backup and Restore</strong>: Create point-in-time snapshots for recovery</p></li>
</ol>
</section>
<section id="current-limitations">
<h3>Current Limitations<a class="headerlink" href="#current-limitations" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>All operations are performed directly on the main database file</p></li>
<li><p>No way to test operations without affecting live data</p></li>
<li><p>Complex multi-step operations can leave database in inconsistent state if interrupted</p></li>
<li><p>No built-in backup/restore mechanism</p></li>
</ul>
</section>
</section>
<section id="detailed-design">
<h2>Detailed Design<a class="headerlink" href="#detailed-design" title="Link to this heading">¶</a></h2>
<section id="core-concepts">
<h3>Core Concepts<a class="headerlink" href="#core-concepts" title="Link to this heading">¶</a></h3>
<section id="branch">
<h4>Branch<a class="headerlink" href="#branch" title="Link to this heading">¶</a></h4>
<p>A branch is an independent copy of a database file that can be modified without affecting the original. Branches maintain metadata about their origin and changes.</p>
</section>
<section id="branch-types">
<h4>Branch Types<a class="headerlink" href="#branch-types" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p><strong>Feature Branch</strong>: Full copy for development work</p></li>
<li><p><strong>Snapshot Branch</strong>: Read-only copy for backup/analysis</p></li>
<li><p><strong>Temporary Branch</strong>: Auto-deleted after session</p></li>
<li><p><strong>Merge Branch</strong>: Specifically for merging changes</p></li>
</ol>
</section>
</section>
<section id="api-design">
<h3>API Design<a class="headerlink" href="#api-design" title="Link to this heading">¶</a></h3>
<section id="core-branch-operations">
<h4>Core Branch Operations<a class="headerlink" href="#core-branch-operations" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">synthdb</span>

<span class="c1"># Create main connection</span>
<span class="n">main_db</span> <span class="o">=</span> <span class="n">synthdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;app.limbo&#39;</span><span class="p">)</span>  <span class="c1"># Uses Limbo by default</span>

<span class="c1"># Create a branch</span>
<span class="n">branch_db</span> <span class="o">=</span> <span class="n">main_db</span><span class="o">.</span><span class="n">create_branch</span><span class="p">(</span><span class="s1">&#39;feature-user-profiles&#39;</span><span class="p">)</span>
<span class="c1"># or</span>
<span class="n">branch_db</span> <span class="o">=</span> <span class="n">main_db</span><span class="o">.</span><span class="n">branch</span><span class="p">(</span><span class="s1">&#39;feature-user-profiles&#39;</span><span class="p">)</span>

<span class="c1"># Work on the branch</span>
<span class="n">branch_db</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="s1">&#39;user_profiles&#39;</span><span class="p">)</span>
<span class="n">branch_db</span><span class="o">.</span><span class="n">add_columns</span><span class="p">(</span><span class="s1">&#39;user_profiles&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;bio&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;avatar&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">})</span>

<span class="c1"># List branches</span>
<span class="n">branches</span> <span class="o">=</span> <span class="n">main_db</span><span class="o">.</span><span class="n">list_branches</span><span class="p">()</span>
<span class="c1"># Returns: [{&#39;name&#39;: &#39;feature-user-profiles&#39;, &#39;created_at&#39;: &#39;...&#39;, &#39;size&#39;: &#39;...&#39;}]</span>

<span class="c1"># Switch between branches</span>
<span class="n">current_branch</span> <span class="o">=</span> <span class="n">main_db</span><span class="o">.</span><span class="n">get_current_branch</span><span class="p">()</span>  <span class="c1"># &#39;main&#39;</span>
<span class="n">main_db</span><span class="o">.</span><span class="n">checkout_branch</span><span class="p">(</span><span class="s1">&#39;feature-user-profiles&#39;</span><span class="p">)</span>

<span class="c1"># Merge branch back to main</span>
<span class="n">merge_result</span> <span class="o">=</span> <span class="n">main_db</span><span class="o">.</span><span class="n">merge_branch</span><span class="p">(</span><span class="s1">&#39;feature-user-profiles&#39;</span><span class="p">)</span>
<span class="c1"># Returns: {&#39;success&#39;: True, &#39;conflicts&#39;: [], &#39;changes_applied&#39;: 15}</span>

<span class="c1"># Delete branch</span>
<span class="n">main_db</span><span class="o">.</span><span class="n">delete_branch</span><span class="p">(</span><span class="s1">&#39;feature-user-profiles&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="advanced-branch-operations">
<h4>Advanced Branch Operations<a class="headerlink" href="#advanced-branch-operations" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create branch from specific point in time</span>
<span class="n">branch_db</span> <span class="o">=</span> <span class="n">main_db</span><span class="o">.</span><span class="n">create_branch</span><span class="p">(</span><span class="s1">&#39;rollback-test&#39;</span><span class="p">,</span> <span class="n">from_timestamp</span><span class="o">=</span><span class="s1">&#39;2024-06-25 10:00:00&#39;</span><span class="p">)</span>

<span class="c1"># Create branch with copy strategy</span>
<span class="n">branch_db</span> <span class="o">=</span> <span class="n">main_db</span><span class="o">.</span><span class="n">create_branch</span><span class="p">(</span><span class="s1">&#39;experiment&#39;</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;copy&#39;</span><span class="p">)</span>  <span class="c1"># Full copy</span>
<span class="n">branch_db</span> <span class="o">=</span> <span class="n">main_db</span><span class="o">.</span><span class="n">create_branch</span><span class="p">(</span><span class="s1">&#39;snapshot&#39;</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;readonly&#39;</span><span class="p">)</span>  <span class="c1"># Read-only reference</span>

<span class="c1"># Branch with auto-cleanup</span>
<span class="k">with</span> <span class="n">main_db</span><span class="o">.</span><span class="n">temporary_branch</span><span class="p">(</span><span class="s1">&#39;temp-operations&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">temp_db</span><span class="p">:</span>
    <span class="n">temp_db</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">})</span>
    <span class="c1"># Branch automatically deleted when exiting context</span>

<span class="c1"># Compare branches</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">main_db</span><span class="o">.</span><span class="n">compare_branches</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">,</span> <span class="s1">&#39;feature-user-profiles&#39;</span><span class="p">)</span>
<span class="c1"># Returns detailed diff of schema and data changes</span>
</pre></div>
</div>
</section>
</section>
<section id="implementation-architecture">
<h3>Implementation Architecture<a class="headerlink" href="#implementation-architecture" title="Link to this heading">¶</a></h3>
<section id="file-system-structure">
<h4>File System Structure<a class="headerlink" href="#file-system-structure" title="Link to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">db</span>                    <span class="c1"># Main database file</span>
<span class="o">.</span><span class="n">synthdb</span><span class="o">/</span>
  <span class="n">branches</span><span class="o">/</span>
    <span class="n">feature</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">profiles</span><span class="o">.</span><span class="n">db</span>     <span class="c1"># Branch database file</span>
    <span class="n">experiment</span><span class="o">.</span><span class="n">db</span>                <span class="c1"># Another branch</span>
  <span class="n">metadata</span><span class="o">/</span>
    <span class="n">branches</span><span class="o">.</span><span class="n">json</span>               <span class="c1"># Branch metadata</span>
    <span class="n">main</span><span class="o">.</span><span class="n">json</span>                  <span class="c1"># Main database metadata</span>
  <span class="n">locks</span><span class="o">/</span>
    <span class="n">feature</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">profiles</span><span class="o">.</span><span class="n">lock</span>  <span class="c1"># Branch locks for concurrent access</span>
</pre></div>
</div>
</section>
<section id="metadata-schema">
<h4>Metadata Schema<a class="headerlink" href="#metadata-schema" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># branches.json structure</span>
<span class="p">{</span>
  <span class="s2">&quot;branches&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;feature-user-profiles&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-06-26T10:00:00Z&quot;</span><span class="p">,</span>
      <span class="s2">&quot;created_from&quot;</span><span class="p">:</span> <span class="s2">&quot;main&quot;</span><span class="p">,</span>
      <span class="s2">&quot;strategy&quot;</span><span class="p">:</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span>
      <span class="s2">&quot;size_bytes&quot;</span><span class="p">:</span> <span class="mi">1048576</span><span class="p">,</span>
      <span class="s2">&quot;last_modified&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-06-26T11:30:00Z&quot;</span><span class="p">,</span>
      <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Adding user profile features&quot;</span><span class="p">,</span>
      <span class="s2">&quot;auto_delete&quot;</span><span class="p">:</span> <span class="n">false</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;main&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="s2">&quot;app.db&quot;</span><span class="p">,</span>
    <span class="s2">&quot;last_branched&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-06-26T10:00:00Z&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="branch-strategies">
<h4>Branch Strategies<a class="headerlink" href="#branch-strategies" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p><strong>Full Copy (<code class="docutils literal notranslate"><span class="pre">copy</span></code>)</strong></p>
<ul class="simple">
<li><p>Complete file copy</p></li>
<li><p>Independent operations</p></li>
<li><p>Higher disk usage</p></li>
<li><p>Safest option</p></li>
</ul>
</li>
<li><p><strong>Copy-on-Write (<code class="docutils literal notranslate"><span class="pre">cow</span></code>)</strong></p>
<ul class="simple">
<li><p>Shared data, separate changes</p></li>
<li><p>More complex implementation</p></li>
<li><p>Better disk efficiency</p></li>
<li><p>Requires filesystem support</p></li>
</ul>
</li>
<li><p><strong>Read-Only Reference (<code class="docutils literal notranslate"><span class="pre">readonly</span></code>)</strong></p>
<ul class="simple">
<li><p>Shared file access</p></li>
<li><p>No modifications allowed</p></li>
<li><p>Minimal overhead</p></li>
<li><p>Good for snapshots</p></li>
</ul>
</li>
</ol>
</section>
</section>
<section id="merge-strategies">
<h3>Merge Strategies<a class="headerlink" href="#merge-strategies" title="Link to this heading">¶</a></h3>
<section id="simple-merge-non-conflicting">
<h4>Simple Merge (Non-Conflicting)<a class="headerlink" href="#simple-merge-non-conflicting" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Schema additions (new tables, columns)</p></li>
<li><p>Data additions (new rows with unique IDs)</p></li>
<li><p>Compatible data type changes</p></li>
</ul>
</section>
<section id="conflict-resolution">
<h4>Conflict Resolution<a class="headerlink" href="#conflict-resolution" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Schema conflicts (same column, different types)</p></li>
<li><p>Data conflicts (same row ID, different values)</p></li>
<li><p>Deletion conflicts (data deleted in one branch, modified in another)</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Manual conflict resolution</span>
<span class="n">conflicts</span> <span class="o">=</span> <span class="n">main_db</span><span class="o">.</span><span class="n">merge_branch</span><span class="p">(</span><span class="s1">&#39;feature-branch&#39;</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">conflict</span> <span class="ow">in</span> <span class="n">conflicts</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">conflict</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;schema_conflict&#39;</span><span class="p">:</span>
        <span class="c1"># Choose resolution strategy</span>
        <span class="n">conflict</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="s1">&#39;prefer_branch&#39;</span><span class="p">)</span>  <span class="c1"># or &#39;prefer_main&#39;, &#39;manual&#39;</span>
    <span class="k">elif</span> <span class="n">conflict</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;data_conflict&#39;</span><span class="p">:</span>
        <span class="c1"># Provide resolution data</span>
        <span class="n">conflict</span><span class="o">.</span><span class="n">resolve_with_data</span><span class="p">({</span><span class="s1">&#39;column&#39;</span><span class="p">:</span> <span class="s1">&#39;new_value&#39;</span><span class="p">})</span>

<span class="c1"># Apply merge with resolutions</span>
<span class="n">merge_result</span> <span class="o">=</span> <span class="n">main_db</span><span class="o">.</span><span class="n">merge_branch</span><span class="p">(</span><span class="s1">&#39;feature-branch&#39;</span><span class="p">,</span> <span class="n">conflicts</span><span class="o">=</span><span class="n">conflicts</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="cli-integration">
<h3>CLI Integration<a class="headerlink" href="#cli-integration" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Branch operations</span>
sdb<span class="w"> </span>branch<span class="w"> </span>create<span class="w"> </span>feature-auth
sdb<span class="w"> </span>branch<span class="w"> </span>list
sdb<span class="w"> </span>branch<span class="w"> </span>switch<span class="w"> </span>feature-auth
sdb<span class="w"> </span>branch<span class="w"> </span>delete<span class="w"> </span>feature-auth

<span class="c1"># Work on branches</span>
sdb<span class="w"> </span>branch<span class="w"> </span>create<span class="w"> </span>experiment
sdb<span class="w"> </span>--branch<span class="w"> </span>experiment<span class="w"> </span>table<span class="w"> </span>create<span class="w"> </span>test_table
sdb<span class="w"> </span>--branch<span class="w"> </span>experiment<span class="w"> </span>add<span class="w"> </span>test_table<span class="w"> </span><span class="s1">&#39;{&quot;name&quot;: &quot;test&quot;}&#39;</span>

<span class="c1"># Merge operations</span>
sdb<span class="w"> </span>branch<span class="w"> </span>merge<span class="w"> </span>feature-auth
sdb<span class="w"> </span>branch<span class="w"> </span>merge<span class="w"> </span>feature-auth<span class="w"> </span>--dry-run
sdb<span class="w"> </span>branch<span class="w"> </span>diff<span class="w"> </span>main<span class="w"> </span>feature-auth

<span class="c1"># Snapshot operations</span>
sdb<span class="w"> </span>branch<span class="w"> </span>snapshot<span class="w"> </span>backup-before-migration
sdb<span class="w"> </span>branch<span class="w"> </span>restore<span class="w"> </span>backup-before-migration
</pre></div>
</div>
</section>
</section>
<section id="implementation-plan">
<h2>Implementation Plan<a class="headerlink" href="#implementation-plan" title="Link to this heading">¶</a></h2>
<section id="phase-1-basic-branching-4-6-weeks">
<h3>Phase 1: Basic Branching (4-6 weeks)<a class="headerlink" href="#phase-1-basic-branching-4-6-weeks" title="Link to this heading">¶</a></h3>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> File copying mechanism</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Branch metadata management</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Basic create/switch/delete operations</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> CLI integration</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Simple merge (non-conflicting)</p></li>
</ul>
</section>
<section id="phase-2-advanced-features-3-4-weeks">
<h3>Phase 2: Advanced Features (3-4 weeks)<a class="headerlink" href="#phase-2-advanced-features-3-4-weeks" title="Link to this heading">¶</a></h3>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Conflict detection and resolution</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Branch comparison and diff</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Temporary branches</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Copy-on-write strategy</p></li>
</ul>
</section>
<section id="phase-3-production-features-2-3-weeks">
<h3>Phase 3: Production Features (2-3 weeks)<a class="headerlink" href="#phase-3-production-features-2-3-weeks" title="Link to this heading">¶</a></h3>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Concurrent access handling</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Performance optimization</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Advanced merge strategies</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Documentation and examples</p></li>
</ul>
</section>
</section>
<section id="considerations">
<h2>Considerations<a class="headerlink" href="#considerations" title="Link to this heading">¶</a></h2>
<section id="performance">
<h3>Performance<a class="headerlink" href="#performance" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>File Copy Overhead</strong>: Large databases will have slow branch creation</p></li>
<li><p><strong>Disk Space</strong>: Multiple branches can consume significant storage</p></li>
<li><p><strong>Merge Complexity</strong>: Large diffs may be slow to process</p></li>
</ul>
<p><strong>Mitigations</strong>:</p>
<ul class="simple">
<li><p>Implement copy-on-write for supported filesystems</p></li>
<li><p>Add disk usage monitoring and warnings</p></li>
<li><p>Provide progress indicators for long operations</p></li>
<li><p>Implement incremental/streaming merges</p></li>
</ul>
</section>
<section id="concurrency">
<h3>Concurrency<a class="headerlink" href="#concurrency" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Branch Access</strong>: Multiple connections to same branch</p></li>
<li><p><strong>Merge Conflicts</strong>: Concurrent modifications during merge</p></li>
<li><p><strong>File Locking</strong>: Platform-specific file locking mechanisms</p></li>
</ul>
<p><strong>Mitigations</strong>:</p>
<ul class="simple">
<li><p>Implement branch-level locking</p></li>
<li><p>Use atomic file operations</p></li>
<li><p>Provide clear error messages for lock conflicts</p></li>
</ul>
</section>
<section id="data-integrity">
<h3>Data Integrity<a class="headerlink" href="#data-integrity" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Partial Merges</strong>: Ensure atomic merge operations</p></li>
<li><p><strong>Corruption</strong>: Protect against file corruption during operations</p></li>
<li><p><strong>Metadata Consistency</strong>: Keep branch metadata in sync with actual files</p></li>
</ul>
<p><strong>Mitigations</strong>:</p>
<ul class="simple">
<li><p>Use database transactions for merge operations</p></li>
<li><p>Implement checksum verification</p></li>
<li><p>Regular metadata validation</p></li>
</ul>
</section>
</section>
<section id="alternative-approaches">
<h2>Alternative Approaches<a class="headerlink" href="#alternative-approaches" title="Link to this heading">¶</a></h2>
<section id="transaction-based-approach">
<h3>1. Transaction-Based Approach<a class="headerlink" href="#transaction-based-approach" title="Link to this heading">¶</a></h3>
<p>Instead of file-level branching, use database transactions with savepoints.</p>
<p><strong>Pros</strong>:</p>
<ul class="simple">
<li><p>No file copying overhead</p></li>
<li><p>Native database support</p></li>
<li><p>Better performance</p></li>
</ul>
<p><strong>Cons</strong>:</p>
<ul class="simple">
<li><p>Limited by database transaction capabilities</p></li>
<li><p>No persistent branches</p></li>
<li><p>Complex rollback scenarios</p></li>
</ul>
</section>
<section id="schema-versioning">
<h3>2. Schema Versioning<a class="headerlink" href="#schema-versioning" title="Link to this heading">¶</a></h3>
<p>Track schema changes and data migrations without full branching.</p>
<p><strong>Pros</strong>:</p>
<ul class="simple">
<li><p>Lightweight implementation</p></li>
<li><p>Good for schema evolution</p></li>
<li><p>Fits existing SynthDB architecture</p></li>
</ul>
<p><strong>Cons</strong>:</p>
<ul class="simple">
<li><p>Limited to schema changes</p></li>
<li><p>No data experimentation</p></li>
<li><p>Complex conflict resolution</p></li>
</ul>
</section>
<section id="virtual-branching">
<h3>3. Virtual Branching<a class="headerlink" href="#virtual-branching" title="Link to this heading">¶</a></h3>
<p>Use overlays and views instead of physical copies.</p>
<p><strong>Pros</strong>:</p>
<ul class="simple">
<li><p>No disk overhead</p></li>
<li><p>Fast branch creation</p></li>
<li><p>Complex query optimization</p></li>
</ul>
<p><strong>Cons</strong>:</p>
<ul class="simple">
<li><p>Very complex implementation</p></li>
<li><p>Performance overhead on queries</p></li>
<li><p>Limited by SQL capabilities</p></li>
</ul>
</section>
</section>
<section id="success-metrics">
<h2>Success Metrics<a class="headerlink" href="#success-metrics" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>Usability</strong>: Branch operations complete in &lt;5 seconds for databases &lt;100MB</p></li>
<li><p><strong>Reliability</strong>: 99.9% success rate for merge operations without conflicts</p></li>
<li><p><strong>Performance</strong>: &lt;10% overhead for operations on branched databases</p></li>
<li><p><strong>Adoption</strong>: Feature used in &gt;30% of SynthDB projects within 6 months</p></li>
</ul>
</section>
<section id="future-enhancements">
<h2>Future Enhancements<a class="headerlink" href="#future-enhancements" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>Remote Branches</strong>: Sync branches across multiple machines</p></li>
<li><p><strong>Automated Merging</strong>: AI-assisted conflict resolution</p></li>
<li><p><strong>Branch Templates</strong>: Predefined branch configurations</p></li>
<li><p><strong>Integration</strong>: Git-like workflow with external version control</p></li>
<li><p><strong>Compression</strong>: Efficient storage for similar branches</p></li>
</ul>
</section>
<section id="related-work">
<h2>Related Work<a class="headerlink" href="#related-work" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>Git</strong>: File-based version control inspiration</p></li>
<li><p><strong>SQLite Backup API</strong>: Technical implementation reference</p></li>
<li><p><strong>Database Replication</strong>: Multi-master conflict resolution patterns</p></li>
<li><p><strong>Copy-on-Write Filesystems</strong>: ZFS, Btrfs implementation examples</p></li>
</ul>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">¶</a></h2>
<p>Database branching would significantly enhance SynthDB’s utility for development, testing, and production workflows. While implementation is complex, the benefits for safe experimentation and parallel development justify the effort.</p>
<p>The proposed design balances functionality with implementation complexity, providing a foundation for both simple use cases and advanced workflows. Starting with basic file copying and expanding to more sophisticated strategies allows for iterative development and user feedback integration.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, SynthDB Contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Feature Proposal: Database Branching</a><ul>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a><ul>
<li><a class="reference internal" href="#use-cases">Use Cases</a></li>
<li><a class="reference internal" href="#current-limitations">Current Limitations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#detailed-design">Detailed Design</a><ul>
<li><a class="reference internal" href="#core-concepts">Core Concepts</a><ul>
<li><a class="reference internal" href="#branch">Branch</a></li>
<li><a class="reference internal" href="#branch-types">Branch Types</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api-design">API Design</a><ul>
<li><a class="reference internal" href="#core-branch-operations">Core Branch Operations</a></li>
<li><a class="reference internal" href="#advanced-branch-operations">Advanced Branch Operations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-architecture">Implementation Architecture</a><ul>
<li><a class="reference internal" href="#file-system-structure">File System Structure</a></li>
<li><a class="reference internal" href="#metadata-schema">Metadata Schema</a></li>
<li><a class="reference internal" href="#branch-strategies">Branch Strategies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#merge-strategies">Merge Strategies</a><ul>
<li><a class="reference internal" href="#simple-merge-non-conflicting">Simple Merge (Non-Conflicting)</a></li>
<li><a class="reference internal" href="#conflict-resolution">Conflict Resolution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cli-integration">CLI Integration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-plan">Implementation Plan</a><ul>
<li><a class="reference internal" href="#phase-1-basic-branching-4-6-weeks">Phase 1: Basic Branching (4-6 weeks)</a></li>
<li><a class="reference internal" href="#phase-2-advanced-features-3-4-weeks">Phase 2: Advanced Features (3-4 weeks)</a></li>
<li><a class="reference internal" href="#phase-3-production-features-2-3-weeks">Phase 3: Production Features (2-3 weeks)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#considerations">Considerations</a><ul>
<li><a class="reference internal" href="#performance">Performance</a></li>
<li><a class="reference internal" href="#concurrency">Concurrency</a></li>
<li><a class="reference internal" href="#data-integrity">Data Integrity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#alternative-approaches">Alternative Approaches</a><ul>
<li><a class="reference internal" href="#transaction-based-approach">1. Transaction-Based Approach</a></li>
<li><a class="reference internal" href="#schema-versioning">2. Schema Versioning</a></li>
<li><a class="reference internal" href="#virtual-branching">3. Virtual Branching</a></li>
</ul>
</li>
<li><a class="reference internal" href="#success-metrics">Success Metrics</a></li>
<li><a class="reference internal" href="#future-enhancements">Future Enhancements</a></li>
<li><a class="reference internal" href="#related-work">Related Work</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=01f34227"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    </body>
</html>